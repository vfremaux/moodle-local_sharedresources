{"version":3,"file":"library.min.js","sources":["../src/library.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * A general JS library for library display.\n * @module     local_sharedresource/library\n * @package    local\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/config', 'core/log', 'core/str'], function ($, cfg, log, str) {\n\n    var sharedresourceslibrary = {\n\n        strs: [],\n\n        init: function (args) {\n\n            var stringdefs = [\n                {key: 'confirmresourceforcedeletion', component: 'local_sharedresources'}, // 0\n                {key: 'confirmresourcedeletion', component: 'local_sharedresources'}, // 1\n            ];\n\n            str.get_strings(stringdefs).done(function(s) {\n                sharedresourceslibrary.strs = s;\n            });\n\n            var that = $(this);\n            log.debug(JSON.stringify(args));\n            sharedresourceslibrary.courseid = args[0];\n\n            // Resourceitem hover effect.\n            $('.resourceitem').hover(\n                function() {\n                    that.css('background-color','#fcfcfc');\n                },\n                function() {\n                    that.css('background-color','#f8f8f8');\n                }\n            );\n\n            // Delegated handlers so reloading version gets bound too.\n            $('#resources').on('click', '.sharedresource-toggle-handle', this.toggle_info_panel);\n            $('#resources').on('click', '.sharedresource-mark-like', this.ajax_mark_like);\n            $('#resources').on('click', '.sharedresource-actionlink', this.integrate);\n            $('#resources').on('click', '.sharedresource.delete', this.confirm);\n            $('#resources').on('click', '.sharedresource.force-delete', this.confirm);\n            $('#resources').on('click', '.shr-version', this.toversion);\n\n            log.debug('ADM Shared resource Library JS initialized');\n        },\n\n        ajax_mark_like: function () {\n\n            var identifier = $(this).attr('id').replace('sharedresource-', '');\n            var arr = identifier.split('-'); // Has repo-resid form.\n            var repoid = arr[0];\n            var residentifier = arr[1];\n\n            var url = cfg.wwwroot + '/local/sharedresources/ajax/add_liked_mark.php?';\n            url += 'resid=' + residentifier + '&repo=' + repoid;\n\n            $.get(url, '', function(data) {\n                $('#sharedresource-likes-' + residentifier).html(sharedresourceslibrary.sharedresource_print_stars(data, 15));\n            }, 'html');\n        },\n\n        sharedresource_print_stars: function (stars, maxstars) {\n\n            var str = '';\n\n            for (var i = 0; i < maxstars; i++) {\n                var icon = (i < stars) ? 'star' : 'star_shadow';\n                var pixicon = cfg.wwwroot + '/local/sharedresources/pix/' + icon + '.png';\n                str += '<img src=\"'+ pixicon + '\" />';\n            }\n            return str;\n        },\n\n        toggle_info_panel: function () {\n\n            var that = $(this);\n\n            var imgid = that.attr('id');\n            var iconsrc;\n            var residentifier = imgid.replace('sharedresource-toggle-', '');\n\n            if ($('#sharedresource-info-' + residentifier).css('display') === 'none') {\n                $('#sharedresource-info-' + residentifier).css('display', 'block');\n                $('#sharedresource-social-' + residentifier).css('display', 'block');\n                iconsrc = $('#sharedresource-toggle-' + residentifier).attr('src');\n                iconsrc = iconsrc.replace('right', 'top');\n                $('#sharedresource-toggle-' + residentifier).attr('src', iconsrc);\n            } else {\n                $('#sharedresource-info-' + residentifier).css('display', 'none');\n                $('#sharedresource-social-' + residentifier).css('display', 'none');\n                iconsrc = $('#sharedresource-toggle-' + residentifier).attr('src');\n                iconsrc = iconsrc.replace('top', 'right');\n                $('#sharedresource-toggle-' + residentifier).attr('src', iconsrc);\n            }\n        },\n\n        integrate: function() {\n\n            var that = $(this);\n\n            var matches = that.attr('id').match(/id-(\\w+)-(\\d+)/);\n            var command = matches[1];\n            var ix = matches[2];\n            document.forms['add' + ix].mode.value = command;\n            document.forms['add' + ix].submit();\n        },\n\n        confirm: function(e) {\n\n            var that = $(this);\n\n            var strindex = 0;\n            if (that.hasClass('delete')) {\n                strindex = 1;\n            }\n\n            if (!confirm(sharedresourceslibrary.strs[strindex])) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                return false;\n            }\n        },\n\n        toversion: function(e) {\n            var that = $(this);\n\n            var versionid = that.attr('data-version');\n            var containerid = that.attr('data-container');\n            var courseid = that.attr('data-container');\n            var arr = containerid.split('-'); // Has repo-resid form.\n            var repoid = arr[0];\n            var residentifier = arr[1];\n            var waiter = '<div class=\"shr-waiter\"><img src=\"' + cfg.wwwroot + '/pix/i/ajaxloader.gif\"></div>';\n\n            // Fetch and replace resource box content.\n            var url = cfg.wwwroot + '/local/sharedresources/ajax/get_version.php';\n            url += '?resid=' + versionid;\n            url += '&repo=' + repoid;\n            url += '&courseid=' + sharedresourceslibrary.courseid;\n            url += '&isediting=' + $('#resources').hasClass('is-editing');\n            $('#id-shr-container-' + containerid).html(waiter);\n            $.get(url, function(data) {\n                $('#id-shr-container-' + containerid).html(data);\n            }, 'html');\n        }\n\n    };\n\n    return sharedresourceslibrary;\n});"],"names":["define","$","cfg","log","str","sharedresourceslibrary","strs","init","args","get_strings","key","component","done","s","that","this","debug","JSON","stringify","courseid","hover","css","on","toggle_info_panel","ajax_mark_like","integrate","confirm","toversion","arr","attr","replace","split","repoid","residentifier","url","wwwroot","get","data","html","sharedresource_print_stars","stars","maxstars","i","icon","iconsrc","matches","match","command","ix","document","forms","mode","value","submit","e","strindex","hasClass","preventDefault","stopImmediatePropagation","versionid","containerid","waiter"],"mappings":"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"}