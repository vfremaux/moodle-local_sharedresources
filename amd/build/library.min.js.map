{"version":3,"file":"library.min.js","sources":["../src/library.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n *\n * @module     local_sharedresource/library\n * @package    local\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n// jshint unused: true, undef:true\ndefine(['jquery', 'core/config', 'core/log', 'core/str'], function ($, cfg, log, str) {\n\n    var sharedresourceslibrary = {\n\n        strs: [],\n\n        init: function (args) {\n\n            var stringdefs = [\n                {key: 'confirmresourceforcedeletion', component: 'local_sharedresources'}, // 0\n                {key: 'confirmresourcedeletion', component: 'local_sharedresources'}, // 1\n            ];\n\n            str.get_strings(stringdefs).done(function(s) {\n                sharedresourceslibrary.strs = s;\n            });\n\n            var that = $(this);\n\n            // Resourceitem hover effect.\n            $('.resourceitem').hover(\n                function() {\n                    that.css('background-color','#fcfcfc');\n                },\n                function() {\n                    that.css('background-color','#f8f8f8');\n                }\n            );\n\n            $('.sharedresource-toggle-handle').bind('click', this.toggle_info_panel);\n            $('.sharedresource-mark-like').on('click', '', args, this.ajax_mark_like);\n            $('.sharedresource-actionlink').bind('click', this.integrate);\n            $('.sharedresource.delete').bind('click', this.confirm);\n            $('.sharedresource.force-delete').bind('click', this.confirm);\n\n            log.debug('ADM Shared resource Library JS initialized');\n        },\n\n        ajax_mark_like: function () {\n\n            var identifier = $(this).attr('id').replace('sharedresource-', '');\n            var arr = identifier.split('-'); // Has repo-resid form.\n            var repoid = arr[0];\n            var residentifier = arr[1];\n\n            var url = cfg.wwwroot + '/local/sharedresources/ajax/add_liked_mark.php?';\n            url += 'resid=' + residentifier + '&repo=' + repoid;\n\n            $.get(url, '', function(data) {\n                $('#sharedresource-likes-' + residentifier).html(sharedresourceslibrary.sharedresource_print_stars(data, 15));\n            }, 'html');\n        },\n\n        sharedresource_print_stars: function (stars, maxstars) {\n\n            var str = '';\n\n            for (var i = 0; i < maxstars; i++) {\n                var icon = (i < stars) ? 'star' : 'star_shadow';\n                var pixicon = cfg.wwwroot + '/local/sharedresources/pix/' + icon + '.png';\n                str += '<img src=\"'+ pixicon + '\" />';\n            }\n            return str;\n        },\n\n        toggle_info_panel: function () {\n\n            var that = $(this);\n\n            var imgid = that.attr('id');\n            var iconsrc;\n            var residentifier = imgid.replace('sharedresource-toggle-', '');\n\n            if ($('#sharedresource-info-' + residentifier).css('display') === 'none') {\n                $('#sharedresource-info-' + residentifier).css('display', 'block');\n                $('#sharedresource-social-' + residentifier).css('display', 'block');\n                iconsrc = $('#sharedresource-toggle-' + residentifier).attr('src');\n                iconsrc = iconsrc.replace('right', 'top');\n                $('#sharedresource-toggle-' + residentifier).attr('src', iconsrc);\n            } else {\n                $('#sharedresource-info-' + residentifier).css('display', 'none');\n                $('#sharedresource-social-' + residentifier).css('display', 'none');\n                iconsrc = $('#sharedresource-toggle-' + residentifier).attr('src');\n                iconsrc = iconsrc.replace('top', 'right');\n                $('#sharedresource-toggle-' + residentifier).attr('src', iconsrc);\n            }\n        },\n\n        integrate: function() {\n\n            var that = $(this);\n\n            var matches = that.attr('id').match(/id-(\\w+)-(\\d+)/);\n            var command = matches[1];\n            var ix = matches[2];\n            document.forms['add' + ix].mode.value = command;\n            document.forms['add' + ix].submit();\n        },\n\n        confirm: function(e) {\n\n            var that = $(this);\n\n            var strindex = 0;\n            if (that.hasClass('delete')) {\n                strindex = 1;\n            }\n\n            if (!confirm(sharedresourceslibrary.strs[strindex])) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                return false;\n            }\n        }\n\n    };\n\n    return sharedresourceslibrary;\n});"],"names":["define","$","cfg","log","str","sharedresourceslibrary","strs","init","args","get_strings","key","component","done","s","that","this","hover","css","bind","toggle_info_panel","on","ajax_mark_like","integrate","confirm","debug","arr","attr","replace","split","repoid","residentifier","url","wwwroot","get","data","html","sharedresource_print_stars","stars","maxstars","i","icon","iconsrc","matches","match","command","ix","document","forms","mode","value","submit","_confirm","_x","apply","arguments","toString","e","strindex","hasClass","preventDefault","stopImmediatePropagation"],"mappings":";;;;;;AAsBAA,uCAAO,CAAC,SAAU,cAAe,WAAY,aAAa,SAAUC,EAAGC,IAAKC,IAAKC,KAE7E,IAAIC,uBAAyB,CAEzBC,KAAM,GAENC,KAAM,SAAUC,MAOZJ,IAAIK,YALa,CACb,CAACC,IAAK,+BAAgCC,UAAW,yBACjD,CAACD,IAAK,0BAA2BC,UAAW,2BAGpBC,MAAK,SAASC,GACtCR,uBAAuBC,KAAOO,CAClC,IAEA,IAAIC,KAAOb,EAAEc,MAGbd,EAAE,iBAAiBe,OACf,WACIF,KAAKG,IAAI,mBAAmB,UAChC,IACA,WACIH,KAAKG,IAAI,mBAAmB,UAChC,IAGJhB,EAAE,iCAAiCiB,KAAK,QAASH,KAAKI,mBACtDlB,EAAE,6BAA6BmB,GAAG,QAAS,GAAIZ,KAAMO,KAAKM,gBAC1DpB,EAAE,8BAA8BiB,KAAK,QAASH,KAAKO,WACnDrB,EAAE,0BAA0BiB,KAAK,QAASH,KAAKQ,SAC/CtB,EAAE,gCAAgCiB,KAAK,QAASH,KAAKQ,SAErDpB,IAAIqB,MAAM,6CACb,EAEDH,eAAgB,WAEZ,IACII,IADaxB,EAAEc,MAAMW,KAAK,MAAMC,QAAQ,kBAAmB,IAC1CC,MAAM,KACvBC,OAASJ,IAAI,GACbK,cAAgBL,IAAI,GAEpBM,IAAM7B,IAAI8B,QAAU,kDACxBD,KAAO,SAAWD,cAAgB,SAAWD,OAE7C5B,EAAEgC,IAAIF,IAAK,IAAI,SAASG,MACpBjC,EAAE,yBAA2B6B,eAAeK,KAAK9B,uBAAuB+B,2BAA2BF,KAAM,IAC5G,GAAE,OACN,EAEDE,2BAA4B,SAAUC,MAAOC,UAIzC,IAFA,IAAIlC,IAAM,GAEDmC,EAAI,EAAGA,EAAID,SAAUC,IAAK,CAC/B,IAAIC,KAAQD,EAAIF,MAAS,OAAS,cAElCjC,KAAO,cADOF,IAAI8B,QAAU,8BAAgCQ,KAAO,QACpC,MACnC,CACA,OAAOpC,GACV,EAEDe,kBAAmB,WAEf,IAGIsB,QACAX,cAJO7B,EAAEc,MAEIW,KAAK,MAEIC,QAAQ,yBAA0B,IAEM,SAA9D1B,EAAE,wBAA0B6B,eAAeb,IAAI,YAC/ChB,EAAE,wBAA0B6B,eAAeb,IAAI,UAAW,SAC1DhB,EAAE,0BAA4B6B,eAAeb,IAAI,UAAW,SAE5DwB,SADAA,QAAUxC,EAAE,0BAA4B6B,eAAeJ,KAAK,QAC1CC,QAAQ,QAAS,OACnC1B,EAAE,0BAA4B6B,eAAeJ,KAAK,MAAOe,WAEzDxC,EAAE,wBAA0B6B,eAAeb,IAAI,UAAW,QAC1DhB,EAAE,0BAA4B6B,eAAeb,IAAI,UAAW,QAE5DwB,SADAA,QAAUxC,EAAE,0BAA4B6B,eAAeJ,KAAK,QAC1CC,QAAQ,MAAO,SACjC1B,EAAE,0BAA4B6B,eAAeJ,KAAK,MAAOe,SAEhE,EAEDnB,UAAW,WAEP,IAEIoB,QAFOzC,EAAEc,MAEMW,KAAK,MAAMiB,MAAM,kBAChCC,QAAUF,QAAQ,GAClBG,GAAKH,QAAQ,GACjBI,SAASC,MAAM,MAAQF,IAAIG,KAAKC,MAAQL,QACxCE,SAASC,MAAM,MAAQF,IAAIK,QAC9B,EAED3B,QAAO,SAAA4B,UAAA,SAAA5B,QAAA6B,IAAA,OAAAD,SAAAE,MAAAtC,KAAAuC,UAAA,CAAA,OAAA/B,QAAAgC,SAAA,WAAA,OAAAJ,SAAAI,UAAA,EAAAhC,OAAE,CAAF,EAAE,SAASiC,GAEd,IAEIC,SAAW,EAKf,GAPWxD,EAAEc,MAGJ2C,SAAS,YACdD,SAAW,IAGVlC,QAAQlB,uBAAuBC,KAAKmD,WAGrC,OAFAD,EAAEG,iBACFH,EAAEI,4BACK,MAMnB,OAAOvD,sBACX"}